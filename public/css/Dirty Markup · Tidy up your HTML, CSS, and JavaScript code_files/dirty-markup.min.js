$(document).ready(function(){function e(){var e=$(window).width()-p.outerWidth(),t=$(window).height();if(c)$("#editor, #textarea-editor").width(e).height(t),c.resize();else{var a=parseInt(m.css("paddingTop"),10)+parseInt(m.css("paddingBottom"),10),s=parseInt(m.css("paddingLeft"),10)+parseInt(m.css("paddingRight"),10);m.width(e-s).height(t-a)}}function t(e){r.find(":input").each(function(){$(this).is(":radio, :checkbox")?$(this).prop("checked","true"===$.cookie($(this).attr("name"))):$(this).attr("name")&&$.cookie($(this).attr("name"))&&$(this).val($.cookie($(this).attr("name")))}),a($.cookie("mode")),o(),n(),e&&e.call()}function a(e){e&&e.match(/(html|css|javascript)/)||(e="html"),d=e,$("#mode").val(e),$("[data-mode]").removeClass().addClass("btn btn-default"),$('[data-mode="'+e+'"]').removeClass().addClass("btn btn-primary"),$("[data-show-for]").each(function(){var t=$(this).attr("data-show-for");$(this).toggleClass("hidden",-1===t.indexOf(e))}),$.cookie("mode",e,{expires:365,path:"/"}),c&&(c.getSession().setMode(new h.javascript),c.getSession().setMode(new h[e]))}function s(e){switch(e){case"light":$("body").removeClass().addClass("theme-light"),c.setTheme("ace/theme/tomorrow");break;default:$("body").removeClass().addClass("theme-dark"),c.setTheme("ace/theme/pastel_on_dark")}}function i(e){c?c.getSession().setValue(e):m.val(e)}function o(){var e=$("#indent-size"),t=e.val();"tabs"===t?c&&(c.getSession().setTabSize(4),c.getSession().setUseSoftTabs(!1)):(t=parseInt(e.val(),10),2!==t&&4!==t&&8!==t&&(t=4),c&&(c.getSession().setTabSize(t),c.getSession().setUseSoftTabs(!0))),e.val(t)}function n(){var e=$("#print-margin"),t=parseInt(e.val(),10);(0>t||t>200)&&(t=80),e.val(t),c&&(c.setShowPrintMargin(t>0),c.setPrintMarginColumn(t))}var r=$("#dirtymarkup-form"),d=$.cookie("mode"),c,h,l,p=$("#sidebar"),m=$("#textarea-editor");h={html:require("ace/mode/html").Mode,css:require("ace/mode/css").Mode,javascript:require("ace/mode/javascript").Mode},m.addClass("hidden"),c=ace.edit("editor"),ace.config.set("basePath","/src/lib/ace-builds/src-min/"),s($.cookie("theme")),c.getSession().setTabSize(4),c.getSession().setMode(new h.html),c.getSession().setValue(m.val()),t(function(){c&&c.focus()}),$(window).on("resize",e),e(),$("[data-mode]").on("click",function(){a($(this).attr("data-mode"))}),$("#indent-size").on("change",o),$("#print-margin").on("change",n),r.find(":input").on("change",function(){$(this).is(":radio, :checkbox")?$.cookie($(this).attr("name"),$(this).prop("checked"),{expires:365,path:"/"}):$.cookie($(this).attr("name"),$(this).val(),{expires:365,path:"/"})}),$("#theme").on("change",function(){s($(this).val())}),r.on("submit",function(e){if(e.preventDefault(),!r.hasClass("busy"))switch(d){case"javascript":var t=c?c.getSession().getValue():m.val(),a;a=js_beautify(t,{brace_style:$("#brace-style").val(),break_chained_methods:$("#break-chained-methods").prop("checked"),indent_char:"tabs"===$("#indent-size").val()?"	":" ",indent_size:"tabs"===$("#indent-size").val()?1:$("#indent-size").val(),keep_array_indentation:$("#keep-array-indentation").prop("checked"),preserve_newlines:$("#preserve-empty-lines").prop("checked"),wrap_line_length:parseInt($("#print-margin").val(),10)||null}),m.val(a),c&&(c.getSession().setValue(a),c.gotoLine(1));break;default:r.addClass("busy"),l&&l.abort(),c&&m.val(c.getSession().getValue()),l=$.post("/src/ajax/dirty.ajax.php",r.serialize(),function(e){r.removeClass("busy"),m.val(e.code),c&&(c.getSession().setValue(e.code),c.gotoLine(1))},"json")}}),postData&&(postData.mode&&a(postData.mode),postData.code&&i(postData.code),postData.clean&&"true"===postData.clean.toLowerCase()&&r.submit())});